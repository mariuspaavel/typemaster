CREATE OR REPLACE FUNCTION submitbirth(
	asessionid INTEGER,
	abirth BIGINT
)
RETURNS void
LANGUAGE plpgsql
AS $$
BEGIN
	IF abirth < -1577921940000 THEN
		RAISE EXCEPTION 'Too old';
	END IF;
	IF abirth > extract(epoch from now())*1000 - 18::BIGINT*365*24*60*60*1000 THEN
		RAISE EXCEPTION 'Too young';
	END IF;
	PERFORM ensureform(asessionid);
	UPDATE regforms SET birth=abirth WHERE sessionid=asessionid;
END; 
$$;
