CREATE OR REPLACE FUNCTION login(
	asessionid INTEGER,
	acontact VARCHAR(50),
	apassword VARCHAR(32)
)
RETURNS INTEGER
LANGUAGE plpgsql
AS $$
DECLARE
	rec RECORD;
BEGIN 
	SELECT accountid, pwhash FROM accounts INTO rec WHERE contact=acontact;
	IF NOT FOUND THEN
		RAISE 'Contact not found' USING ERRCODE='contact_not_found';
	END IF;
	IF MD5(apassword) <> rec.pwhash THEN
		RAISE 'Wrong password' USING ERRCODE='wrong_password';
	END IF;
	PERFORM adminlogin(asessionid, rec.accountid);
	RETURN rec.accountid;
END;
$$;	
